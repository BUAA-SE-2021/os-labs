<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Problem Set 0 #  实验说明 #   单人完成，代码要求每人一份（只需提交两个 *.c文件）。除代码外，还需要提交文档。内容可为设计和需求说明、解决思路等，无文档模板，自由发挥。 对于每个人而言，请仅提交一个 PDF 文件（如果有多个文档，请合并成一个。推荐把所有内容写在一个 Markdown/LaTex 项目里）。由组长将每个人的代码文件和 PDF 文档收齐后，将每个人的提交内容放在各自的文件夹后打包为 Zip 包提交。 本次实验因为不涉及多人合作，故对 Git 的使用没有要求。此后的 Project 1 开始，会对小组使用 Git 的情况进行考察。 本实验需要利用操作系统的同步机制，实现问题中要求的逻辑功能。 实验代码可在官网中自行下载，无需 Pintos 环境即可直接运行。  实验内容 #   Problem 1：自动化车站  乘客行为：到站台等车、车来则上车 火车行为：到站装载乘客，无人等待或车已满就开走 让乘客和火车的行为流畅运行，以实现车站的自动化管理   Problem 2：氢原子与氧原子结合，生成 H2O  2 个 H 和 1 个 O 生成水分子 如何保证 H2O 结构正常生成，不会遗漏或多加原子    Problem 1 #  需求 #  CalTrain 程序想让你通过自动化列车和乘客管理来提高效率。每名乘客和每列火车都由一个线程控制。 要求编写同步函数，以确保列车的有序装载。避免出现多人上车座位不够的情况。">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Problem Set 0">
<meta property="og:description" content="Problem Set 0 #  实验说明 #   单人完成，代码要求每人一份（只需提交两个 *.c文件）。除代码外，还需要提交文档。内容可为设计和需求说明、解决思路等，无文档模板，自由发挥。 对于每个人而言，请仅提交一个 PDF 文件（如果有多个文档，请合并成一个。推荐把所有内容写在一个 Markdown/LaTex 项目里）。由组长将每个人的代码文件和 PDF 文档收齐后，将每个人的提交内容放在各自的文件夹后打包为 Zip 包提交。 本次实验因为不涉及多人合作，故对 Git 的使用没有要求。此后的 Project 1 开始，会对小组使用 Git 的情况进行考察。 本实验需要利用操作系统的同步机制，实现问题中要求的逻辑功能。 实验代码可在官网中自行下载，无需 Pintos 环境即可直接运行。  实验内容 #   Problem 1：自动化车站  乘客行为：到站台等车、车来则上车 火车行为：到站装载乘客，无人等待或车已满就开走 让乘客和火车的行为流畅运行，以实现车站的自动化管理   Problem 2：氢原子与氧原子结合，生成 H2O  2 个 H 和 1 个 O 生成水分子 如何保证 H2O 结构正常生成，不会遗漏或多加原子    Problem 1 #  需求 #  CalTrain 程序想让你通过自动化列车和乘客管理来提高效率。每名乘客和每列火车都由一个线程控制。 要求编写同步函数，以确保列车的有序装载。避免出现多人上车座位不够的情况。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://buaa-se-2021.github.io/os-labs/docs/table-of-contents/ps0/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2021-10-12T22:31:23+08:00">
<title>Problem Set 0 | OS Pintos Labs</title>
<link rel=manifest href=/os-labs/manifest.json>
<link rel=icon href=/os-labs/favicon.png type=image/x-icon>
<link rel=stylesheet href=/os-labs/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous>
<script defer src=/os-labs/flexsearch.min.js></script>
<script defer src=/os-labs/en.search.min.2003f2497bed3ea4662a088a47302b5491abc9b7fab870d6473b3d4012c723e4.js integrity="sha256-IAPySXvtPqRmKgiKRzArVJGrybf6uHDWRzs9QBLHI+Q=" crossorigin=anonymous></script>
<script defer src=/os-labs/sw.min.f3b6af0beade35f9c86f5d5b080c54bb4c91287aa795367fa753608e508ce5e4.js integrity="sha256-87avC+reNfnIb11bCAxUu0yRKHqnlTZ/p1NgjlCM5eQ=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/os-labs/><span>OS Pintos Labs</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/table-of-contents/>Table of Contents</a>
<ul>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/table-of-contents/ps0/ class=active>Problem Set 0</a>
</li>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/table-of-contents/p1/>Project 1</a>
</li>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/table-of-contents/p2/>Project 2</a>
</li>
</ul>
</li>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/resources/>Resources</a>
<ul>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/resources/weekly-meeting-report/>周例会报告模板</a>
</li>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/resources/install-pintos/>Pintos 环境搭建</a>
</li>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/resources/doc-template/>实验文档模板</a>
</li>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/resources/project01-design-doc/>Project 1 DesignDoc 模板</a>
</li>
<li>
<a href=https://buaa-se-2021.github.io/os-labs/docs/resources/project02-design-doc/>Project 2 DesignDoc 模板</a>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<a href=https://github.com/BUAA-SE-2021/os-labs target=_blank rel=noopener>
Github
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/os-labs/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Problem Set 0</strong>
<label for=toc-control>
<img src=/os-labs/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#problem-set-0>Problem Set 0</a>
<ul>
<li><a href=#实验说明>实验说明</a></li>
<li><a href=#实验内容>实验内容</a></li>
<li><a href=#problem-1>Problem 1</a>
<ul>
<li><a href=#需求>需求</a></li>
<li><a href=#步骤>步骤</a></li>
<li><a href=#要求>要求</a></li>
</ul>
</li>
<li><a href=#problem-2>Problem 2</a>
<ul>
<li><a href=#需求-1>需求</a></li>
<li><a href=#步骤-1>步骤</a></li>
<li><a href=#要求-1>要求</a></li>
</ul>
</li>
<li><a href=#测试方法>测试方法</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=problem-set-0>
Problem Set 0
<a class=anchor href=#problem-set-0>#</a>
</h1>
<h2 id=实验说明>
实验说明
<a class=anchor href=#%e5%ae%9e%e9%aa%8c%e8%af%b4%e6%98%8e>#</a>
</h2>
<ul>
<li>单人完成，代码要求每人一份（只需提交两个 <code>*.c</code>文件）。除代码外，还需要提交文档。内容可为设计和需求说明、解决思路等，无文档模板，自由发挥。</li>
<li>对于每个人而言，请仅提交一个 PDF 文件（如果有多个文档，请合并成一个。推荐把所有内容写在一个 Markdown/LaTex 项目里）。由组长将每个人的代码文件和 PDF 文档收齐后，将每个人的提交内容放在各自的文件夹后打包为 Zip 包提交。</li>
<li>本次实验因为不涉及多人合作，故对 Git 的使用没有要求。此后的 Project 1 开始，会对小组使用 Git 的情况进行考察。</li>
<li>本实验需要利用操作系统的同步机制，实现问题中要求的逻辑功能。</li>
<li>实验代码可在官网中自行下载，无需 Pintos 环境即可直接运行。</li>
</ul>
<h2 id=实验内容>
实验内容
<a class=anchor href=#%e5%ae%9e%e9%aa%8c%e5%86%85%e5%ae%b9>#</a>
</h2>
<ul>
<li>Problem 1：自动化车站
<ul>
<li>乘客行为：到站台等车、车来则上车</li>
<li>火车行为：到站装载乘客，无人等待或车已满就开走</li>
<li>让乘客和火车的行为流畅运行，以实现车站的自动化管理</li>
</ul>
</li>
<li>Problem 2：氢原子与氧原子结合，生成 H2O
<ul>
<li>2 个 H 和 1 个 O 生成水分子</li>
<li>如何保证 H2O 结构正常生成，不会遗漏或多加原子</li>
</ul>
</li>
</ul>
<h2 id=problem-1>
Problem 1
<a class=anchor href=#problem-1>#</a>
</h2>
<h3 id=需求>
需求
<a class=anchor href=#%e9%9c%80%e6%b1%82>#</a>
</h3>
<p>CalTrain 程序想让你通过自动化列车和乘客管理来提高效率。每名乘客和每列火车都由一个线程控制。 要求编写同步函数，以确保列车的有序装载。避免出现多人上车座位不够的情况。</p>
<h3 id=步骤>
步骤
<a class=anchor href=#%e6%ad%a5%e9%aa%a4>#</a>
</h3>
<ul>
<li>定义 <code>station</code> 结构体
<ul>
<li>包含程序所用的信号量、锁、条件变量</li>
</ul>
</li>
<li>编写以下处理函数：
<ul>
<li>初始化函数：<code>station_init(struct station *station)</code></li>
<li>初始化结构体中的数据</li>
</ul>
</li>
<li>列车行为：
<ul>
<li>火车到站打开车门：<code>station_load_train(struct station *station, int count)</code></li>
<li>当且仅当列车已满或无乘客等待时，该函数返回</li>
</ul>
</li>
<li>乘客行为：
<ul>
<li>到站等车，添加一名位于等待状态的乘客：<code>station_wait_for_train(struct station *station)</code></li>
<li>乘客就坐，“通知”列车当前乘客已经就坐：<code>station_on_board(struct station *station)</code></li>
</ul>
</li>
<li>外层调用无需考虑，只需定义结构体和同步机制所需的函数</li>
</ul>
<h3 id=要求>
要求
<a class=anchor href=#%e8%a6%81%e6%b1%82>#</a>
</h3>
<ul>
<li>允许多名乘客等车</li>
<li>只需改动 <code>caltrain.c</code></li>
<li>不能造成忙等待</li>
<li>只能使用以下函数
<ul>
<li><code>lock_init (struct lock *lock)</code></li>
<li><code>lock_acquire(struct lock *lock)</code></li>
<li><code>lock_release(struct lock *lock)</code></li>
<li><code>cond_init(struct condition *cond)</code></li>
<li><code>cond_wait(struct condition *cond, struct lock *lock)</code></li>
<li><code>cond_signal(struct condition *cond, struct lock *lock)</code></li>
<li><code>cond_broadcast(struct condition *cond, struct lock *lock)</code></li>
</ul>
</li>
</ul>
<h2 id=problem-2>
Problem 2
<a class=anchor href=#problem-2>#</a>
</h2>
<h3 id=需求-1>
需求
<a class=anchor href=#%e9%9c%80%e6%b1%82-1>#</a>
</h3>
<p>大自然母亲聘请你帮助她解决形成水的化学反应，但是她似乎无法正确处理反应中的同步问题。 将两个 H 原子和一个 O 原子同时放在一起即可生成水分子， 每个原子由一个线程表示。</p>
<h3 id=步骤-1>
步骤
<a class=anchor href=#%e6%ad%a5%e9%aa%a4-1>#</a>
</h3>
<ul>
<li>定义 <code>reaction</code> 结构体</li>
<li>包含程序所用的信号量、锁、条件变量</li>
<li>编写以下处理函数：
<ul>
<li>初始化函数：<code>reaction_init(struct reaction *r)</code></li>
<li>氢氧原子准备结合：<code>void reaction_h(struct reaction *r)</code>、<code>void reaction_o(struct reaction *r)</code></li>
<li>每有一个 H 或 O 原子进入等待，调用该函数，结合成功后返回</li>
</ul>
</li>
<li>在代码中包含结合水的函数：<code>make_water()</code>
<ul>
<li>无需实现，已经给出，需要在逻辑中加入</li>
</ul>
</li>
</ul>
<h3 id=要求-1>
要求
<a class=anchor href=#%e8%a6%81%e6%b1%82-1>#</a>
</h3>
<ul>
<li>允许多个原子等待反应</li>
<li>不能造成忙等待</li>
<li>只需改动 <code>reation.c</code></li>
<li>只能使用以下函数
<ul>
<li><code>lock_init (struct lock *lock)</code></li>
<li><code>lock_acquire(struct lock *lock)</code></li>
<li><code>lock_release(struct lock *lock)</code></li>
<li><code>cond_init(struct condition *cond)</code></li>
<li><code>cond_wait(struct condition *cond, struct lock *lock)</code></li>
<li><code>cond_signal(struct condition *cond, struct lock *lock)</code></li>
<li><code>cond_broadcast(struct condition *cond, struct lock *lock)</code></li>
</ul>
</li>
</ul>
<h2 id=测试方法>
测试方法
<a class=anchor href=#%e6%b5%8b%e8%af%95%e6%96%b9%e6%b3%95>#</a>
</h2>
<ul>
<li>在代码根目录下命令行运行 <code>make run</code></li>
<li>重新编译记得 <code>make clean</code></li>
</ul>
<p>正常运行时命令行输出：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>...Train departed station with <span style=color:#ae81ff>17</span> new passenger<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>expected 17<span style=color:#f92672>)</span>
Looks good!
./reaction <span style=color:#ae81ff>0</span>
Created <span style=color:#ae81ff>0</span> H and <span style=color:#ae81ff>200</span> O atoms <span style=color:#f92672>(</span>0.0% H<span style=color:#f92672>)</span>, expecting <span style=color:#ae81ff>0</span> H2O molecules
Looks good!
</code></pre></div></article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div><a class="flex align-center" href=https://github.com/alex-shpak/hugo-book/commit/e8f8bbc25b9173acc55ec391c1ccb09980d70323 title="Last modified by Yinghao Zhu | October 12, 2021" target=_blank rel=noopener>
<img src=/os-labs/svg/calendar.svg class=book-icon alt=Calendar>
<span>October 12, 2021</span>
</a>
</div>
<div>
<a class="flex align-center" href=https://github.com/alex-shpak/hugo-book/edit/main/exampleSite/content/docs/table-of-contents/ps0.md target=_blank rel=noopener>
<img src=/os-labs/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span>
</a>
</div>
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#problem-set-0>Problem Set 0</a>
<ul>
<li><a href=#实验说明>实验说明</a></li>
<li><a href=#实验内容>实验内容</a></li>
<li><a href=#problem-1>Problem 1</a>
<ul>
<li><a href=#需求>需求</a></li>
<li><a href=#步骤>步骤</a></li>
<li><a href=#要求>要求</a></li>
</ul>
</li>
<li><a href=#problem-2>Problem 2</a>
<ul>
<li><a href=#需求-1>需求</a></li>
<li><a href=#步骤-1>步骤</a></li>
<li><a href=#要求-1>要求</a></li>
</ul>
</li>
<li><a href=#测试方法>测试方法</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>